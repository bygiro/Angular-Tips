angular.module("ng-tips",[]).directive("ngTips",["$timeout","$compile","$parse","$templateCache",function(t,e,n,o){var i=function(i,a,s){function r(t,e){var n,o,i,a;for(u(t)||(t={}),i=0;i<T.length;i++)if(o=T[i],n=v[o],void 0!==t[o]&&(n=t[o]),"string"==typeof n)for(n=n.split(" "),a=0;a<n.length;a++)h[o][n[a]]=h[o][n[a]]||[],h[o][n[a]].push(e)}var l,f,p,c=angular.element,u=angular.isObject,d=angular.extend,g=angular.copy,m={template:'<div class="tooltip fade"><div class="tooltip-arrow"></div><div class="tooltip-inner"><tips></tips></div></div>',"class":"",on:"mouseenter mouseover touchenter",off:"mouseleave mouseout touchleave",onOff:void 0,enable:void 0,placement:"right",tipCloseOn:!1,appendToBody:!1},v=d({},m,i.settings||{}),h={on:{},off:{}},T=["on","off"],O={},y={},b=(document.getElementById,["template","class","on","off","onOff","enable","placement","appendtoBody","tipCloseOn"]),C=i.tips;if("undefined"!=typeof C){for(var k=0;k<b.length;k++){var w=b[k];"undefined"!=typeof i[w]&&(v[w]=i[w])}for(var $=0;$<C.length;$++)r(C[$],$);i.$watch(function(){var t=a[0].getBoundingClientRect();return t.top+"_"+t.left+"_"+t.width+"_"+t.height},function(t,e){Object.keys(O).length&&(p&&clearTimeout(p),p=setTimeout(function(){for(var t in O){var e=O[t],n="right";e.hasClass("top")&&(n="top"),e.hasClass("left")&&(n="left"),e.hasClass("bottom")&&(n="bottom"),e.css(i.getPosition(e,n))}},100))},!0),i.getPosition=function(t,e){var n,o=t[0].getBoundingClientRect(),i=o.width,s=o.height,r=a[0],l=r.getBoundingClientRect(),f=r.offsetTop,p=r.offsetLeft,c=l.width,u=l.height,d=5,g=!1,m={};switch(e){case"top":g=p+c/2-i/2,n=f-s-d/2;break;case"bottom":g=p+c/2-i/2,n=f+u+d/2;break;case"left":g=p-i-d/2,n=f+u/2-s/2;break;case"right":default:g=p+c+d/2,n=f+u/2-s/2}return g!==!1&&(m={left:g+"px",top:n+"px"}),m};var B={};i.tipon=function(s){var r="on"+Object.keys(s);clearTimeout(B[r]),B[r]=setTimeout(function(){t(function(){for(var r in s){var l,f,p,m=s[r],h=g(v);if(m&&!O[r]){if(u(m)?d(h,m):h.content=m,void 0!==h.enable&&!n(h.enable)(i.$parent))return;p=h.tipCloseOn,h.id=h.id||Math.random().toString(36).slice(2),tmpl=h.template,".html"==tmpl.slice(-5).toLowerCase()&&(tmpl=o.get(tmpl)),tmpl=tmpl||v.template,l=/^(right|left|top|bottom)$/gi.test(h.placement)?h.placement.toLowerCase():"right",f=c(tmpl.replace("<tips></tips>",h.content)),f=e(f)(i.$parent),"function"==typeof f[0].getBoundingClientRect&&(h.appendToBody?c(document.querySelectorAll("body")).append(f):a.after(f),O[r]=f,y[r]&&(y[r].remove(),delete y[r]),t(function(t,e,n){return function(){n.attr("id",t.id).addClass(t["class"]+" "+e+" in").css(i.getPosition(n,e))}}(h,l,f)),p&&(f.on(h.tipCloseOn,function(){var t={};t[r]=m,i.tipoff(t)}),"click"==p&&f.css({cursor:"pointer"})))}}})},120)};var j;i.tipoff=function(t){var e="on"+Object.keys(t);clearTimeout(B[e]),B[e]=setTimeout(function(){for(var e in t)O[e]&&(O[e].removeClass("in"),y[e]=O[e],delete O[e]);j||(j=setInterval(function(){for(var t in y)0==window.getComputedStyle(y[t][0]).opacity&&(y[t].remove(),delete y[t]);Object.keys(y).length||(clearInterval(j),j=!1)},100))},120)},l=Object.keys(h.on),f=Object.keys(h.off),a.on(l.concat(f).join(" "),function(t){for(var e,n=l.indexOf(t.type)>=0?"on":"off",o={},a=h[n][t.type],s=0;s<a.length;s++)e=a[s],o[e]=C[e];i["tip"+n](o)}),t(function(){for(var t=0;t<C.length;t++){var e=C[t],o=g(v);(u(e)||void 0!==o.onOff)&&(u(e)&&(o=d(o,e)),void 0!==o.onOff&&i.$parent.$watch(function(t){return function(){return n(t)(i.$parent)}}(o.onOff),function(t){return function(e){var n=e?"on":"off",o={};o[t]=i.tips[t],"off"==n&&O[t]&&O[t].removeClass("in").remove(),i["tip"+n](o)}}(t)))}})}};return{scope:{settings:"=ngTipsSettings",template:"=ngTipsTemplate","class":"=ngTipsClass",on:"=ngTipsOn",off:"=ngTipsOff",onOff:"=ngTipsOnOff",enable:"=ngTipsEnable",tipCloseOn:"=ngTipsTipCloseOn",placement:"=ngTipsPlacement",appendToBody:"=ngTipsAppendToBody",tips:"=ngTipsTips"},restrict:"A",link:i}}]);