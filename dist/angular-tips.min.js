angular.module("ng-tips",[]).directive("ngTips",["$timeout","$compile","$parse","$templateCache",function(t,e,n,o){var i=function(i,a,l){function s(t,e){var n,o,i,a;for(u(t)||(t={}),i=0;i<T.length;i++)if(o=T[i],n=v[o],void 0!==t[o]&&(n=t[o]),"string"==typeof n)for(n=n.split(" "),a=0;a<n.length;a++)h[o][n[a]]=h[o][n[a]]||[],h[o][n[a]].push(e)}var r,p,f,c=angular.element,u=angular.isObject,d=angular.extend,m=angular.copy,g={template:'<div class="tooltip fade"><div class="tooltip-arrow"></div><div class="tooltip-inner"><tips></tips></div></div>',"class":"",on:"mouseenter mouseover touchenter",off:"mouseleave mouseout touchleave",onOff:void 0,enable:void 0,placement:"right",tipCloseOn:!1,appendToBody:!0},v=d({},g,i.settings||{}),h={on:{},off:{}},T=["on","off"],O={},y={},b=(document.getElementById,["template","class","on","off","onOff","enable","placement","appendtoBody","tipCloseOn"]),C=i.tips;if("undefined"!=typeof C){for(var w=0;w<b.length;w++){var k=b[w];"undefined"!=typeof i[k]&&(v[k]=i[k])}for(var $=0;$<C.length;$++)s(C[$],$);i.$watch(function(){var t=a[0].getBoundingClientRect();return t.top+"_"+t.left+"_"+t.width+"_"+t.height},function(t,e){Object.keys(O).length&&(f&&clearTimeout(f),f=setTimeout(function(){for(var t in O){var e=O[t],n="right";e.hasClass("top")&&(n="top"),e.hasClass("left")&&(n="left"),e.hasClass("bottom")&&(n="bottom"),e.css(i.getPosition(e,n))}},100))},!0),i.getPosition=function(t,e){var n,o=t[0].getBoundingClientRect(),i=o.width,l=o.height,s=a[0].getBoundingClientRect(),r=s.top,p=s.left,f=s.width,c=s.height,u=window.scrollX||document.documentElement.scrollLeft,d=window.scrollY||document.documentElement.scrollTop,m=5,g=!1,v={};switch(e){case"top":g=p+f/2-i/2,n=r-l-m/2;break;case"bottom":g=p+f/2-i/2,n=r+c+m/2;break;case"left":g=p-i-m/2,n=r+c/2-l/2;break;case"right":default:g=p+f+m/2,n=r+c/2-l/2}return g!==!1&&(v={left:g+u+"px",top:n+d+"px"}),v};var B={};i.tipon=function(l){var s="on"+Object.keys(l);clearTimeout(B[s]),B[s]=setTimeout(function(){t(function(){for(var s in l){var r,p,f,g=l[s],h=m(v);if(g&&!O[s]){if(u(g)?d(h,g):h.content=g,void 0!==h.enable&&!n(h.enable)(i.$parent))return;f=h.tipCloseOn,h.id=h.id||Math.random().toString(36).slice(2),tmpl=h.template,".html"==tmpl.slice(-5).toLowerCase()&&(tmpl=o.get(tmpl)),tmpl=tmpl||v.template,r=/^(right|left|top|bottom)$/gi.test(h.placement)?h.placement.toLowerCase():"right",p=c(tmpl.replace("<tips></tips>",h.content)),p=e(p)(i.$parent),"function"==typeof p[0].getBoundingClientRect&&(h.appendToBody?c(document.querySelectorAll("body")).append(p):a.after(p),O[s]=p,y[s]&&(y[s].remove(),delete y[s]),t(function(){p.attr("id",h.id).addClass(h["class"]+" "+r+" in").css(i.getPosition(p,r))}),f&&(p.on(h.tipCloseOn,function(){var t={};t[s]=g,i.tipoff(t)}),"click"==f&&p.css({cursor:"pointer"})))}}})},120)};var j;i.tipoff=function(t){var e="on"+Object.keys(t);clearTimeout(B[e]),B[e]=setTimeout(function(){for(var e in t)O[e]&&(O[e].removeClass("in"),y[e]=O[e],delete O[e]);j||(j=setInterval(function(){for(var t in y)0==window.getComputedStyle(y[t][0]).opacity&&(y[t].remove(),delete y[t]);Object.keys(y).length||(clearInterval(j),j=!1)},100))},120)},r=Object.keys(h.on),p=Object.keys(h.off),a.on(r.concat(p).join(" "),function(t){for(var e,n=r.indexOf(t.type)>=0?"on":"off",o={},a=h[n][t.type],l=0;l<a.length;l++)e=a[l],o[e]=C[e];i["tip"+n](o)}),t(function(){for(var t=0;t<C.length;t++){var e=C[t],o=m(v);(u(e)||void 0!==o.onOff)&&(u(e)&&(o=d(o,e)),void 0!==o.onOff&&i.$parent.$watch(function(t){return function(){return n(t)(i.$parent)}}(o.onOff),function(t){return function(e){var n=e?"on":"off",o={};o[t]=i.tips[t],"off"==n&&O[t]&&O[t].removeClass("in").remove(),i["tip"+n](o)}}(t)))}})}};return{scope:{settings:"=ngTipsSettings",template:"=ngTipsTemplate","class":"=ngTipsClass",on:"=ngTipsOn",off:"=ngTipsOff",onOff:"=ngTipsOnOff",enable:"=ngTipsEnable",tipCloseOn:"=ngTipsTipCloseOn",placement:"=ngTipsPlacement",appendToBody:"=ngTipsAppendToBody",tips:"=ngTipsTips"},restrict:"A",link:i}}]);