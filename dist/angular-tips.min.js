angular.module("ng-tips",[]).directive("ngTips",["$timeout","$compile","$parse","$templateCache",function(t,e,n,o){var i=function(i,a,s){function l(t,e){var n,o,i,a;for(u(t)||(t={}),i=0;i<T.length;i++)if(o=T[i],n=v[o],void 0!==t[o]&&(n=t[o]),"string"==typeof n)for(n=n.split(" "),a=0;a<n.length;a++)h[o][n[a]]=h[o][n[a]]||[],h[o][n[a]].push(e)}var r,f,p,c=angular.element,u=angular.isObject,d=angular.extend,m=angular.copy,g={template:'<div class="tooltip fade"><div class="tooltip-arrow"></div><div class="tooltip-inner"><tips></tips></div></div>',"class":"",on:"mouseenter mouseover touchenter",off:"mouseleave mouseout touchleave",onOff:void 0,enable:void 0,placement:"right",tipCloseOn:!1,appendToBody:!1},v=d({},g,i.settings||{}),h={on:{},off:{}},T=["on","off"],O={},y={},b=(document.getElementById,["template","class","on","off","onOff","enable","placement","appendtoBody","tipCloseOn"]),C=i.tips;if("undefined"!=typeof C){for(var w=0;w<b.length;w++){var k=b[w];"undefined"!=typeof i[k]&&(v[k]=i[k])}for(var $=0;$<C.length;$++)l(C[$],$);i.$watch(function(){var t=a[0].getBoundingClientRect();return t.top+"_"+t.left+"_"+t.width+"_"+t.height},function(t,e){Object.keys(O).length&&(p&&clearTimeout(p),p=setTimeout(function(){for(var t in O){var e=O[t],n="right";e.hasClass("top")&&(n="top"),e.hasClass("left")&&(n="left"),e.hasClass("bottom")&&(n="bottom"),e.css(i.getPosition(e,n))}},100))},!0),i.getPosition=function(t,e){var n,o=t[0].getBoundingClientRect(),i=o.width,s=o.height,l=a[0],r=l.getBoundingClientRect(),f=l.offsetTop,p=l.offsetLeft,c=r.width,u=r.height,d=window.scrollX||document.documentElement.scrollLeft,m=window.scrollY||document.documentElement.scrollTop,g=5,v=!1,h={};switch(e){case"top":v=p+c/2-i/2,n=f-s-g/2;break;case"bottom":v=p+c/2-i/2,n=f+u+g/2;break;case"left":v=p-i-g/2,n=f+u/2-s/2;break;case"right":default:v=p+c+g/2,n=f+u/2-s/2}return v!==!1&&(h={left:v+d+"px",top:n+m+"px"}),h};var B={};i.tipon=function(s){var l="on"+Object.keys(s);clearTimeout(B[l]),B[l]=setTimeout(function(){t(function(){for(var l in s){var r,f,p,g=s[l],h=m(v);if(g&&!O[l]){if(u(g)?d(h,g):h.content=g,void 0!==h.enable&&!n(h.enable)(i.$parent))return;p=h.tipCloseOn,h.id=h.id||Math.random().toString(36).slice(2),tmpl=h.template,".html"==tmpl.slice(-5).toLowerCase()&&(tmpl=o.get(tmpl)),tmpl=tmpl||v.template,r=/^(right|left|top|bottom)$/gi.test(h.placement)?h.placement.toLowerCase():"right",f=c(tmpl.replace("<tips></tips>",h.content)),f=e(f)(i.$parent),"function"==typeof f[0].getBoundingClientRect&&(h.appendToBody?c(document.querySelectorAll("body")).append(f):a.after(f),O[l]=f,y[l]&&(y[l].remove(),delete y[l]),t(function(t,e,n){return function(){n.attr("id",t.id).addClass(t["class"]+" "+e+" in").css(i.getPosition(n,e))}}(h,r,f)),p&&(f.on(h.tipCloseOn,function(){var t={};t[l]=g,i.tipoff(t)}),"click"==p&&f.css({cursor:"pointer"})))}}})},120)};var j;i.tipoff=function(t){var e="on"+Object.keys(t);clearTimeout(B[e]),B[e]=setTimeout(function(){for(var e in t)O[e]&&(O[e].removeClass("in"),y[e]=O[e],delete O[e]);j||(j=setInterval(function(){for(var t in y)0==window.getComputedStyle(y[t][0]).opacity&&(y[t].remove(),delete y[t]);Object.keys(y).length||(clearInterval(j),j=!1)},100))},120)},r=Object.keys(h.on),f=Object.keys(h.off),a.on(r.concat(f).join(" "),function(t){for(var e,n=r.indexOf(t.type)>=0?"on":"off",o={},a=h[n][t.type],s=0;s<a.length;s++)e=a[s],o[e]=C[e];i["tip"+n](o)}),t(function(){for(var t=0;t<C.length;t++){var e=C[t],o=m(v);(u(e)||void 0!==o.onOff)&&(u(e)&&(o=d(o,e)),void 0!==o.onOff&&i.$parent.$watch(function(t){return function(){return n(t)(i.$parent)}}(o.onOff),function(t){return function(e){var n=e?"on":"off",o={};o[t]=i.tips[t],"off"==n&&O[t]&&O[t].removeClass("in").remove(),i["tip"+n](o)}}(t)))}})}};return{scope:{settings:"=ngTipsSettings",template:"=ngTipsTemplate","class":"=ngTipsClass",on:"=ngTipsOn",off:"=ngTipsOff",onOff:"=ngTipsOnOff",enable:"=ngTipsEnable",tipCloseOn:"=ngTipsTipCloseOn",placement:"=ngTipsPlacement",appendToBody:"=ngTipsAppendToBody",tips:"=ngTipsTips"},restrict:"A",link:i}}]);